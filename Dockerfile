# -----------------------------------------------------------------------------
# Base image (Python 3.10-slim, audit-safe)
# -----------------------------------------------------------------------------
FROM python:3.10-slim

# -----------------------------------------------------------------------------
# Environment hardening
# -----------------------------------------------------------------------------
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# -----------------------------------------------------------------------------
# Install dependencies
# -----------------------------------------------------------------------------
RUN pip install pipenv

WORKDIR /app

COPY ["Pipfile", "Pipfile.lock", "./"]

RUN pipenv install --system --deploy

# -----------------------------------------------------------------------------
# Copy application artifacts
# -----------------------------------------------------------------------------
COPY predict.py .
COPY models ./Notebook/

# -----------------------------------------------------------------------------
# Expose API port
# -----------------------------------------------------------------------------
EXPOSE 9696

# -----------------------------------------------------------------------------
# Start inference service
# -----------------------------------------------------------------------------
ENTRYPOINT ["gunicorn", "--bind=0.0.0.0:9696", "predict:app"]
